#! /bin/sh

set -e
set -u

NAME=$1
TARGET_PREFIX=$2

gen_file () {
BIN_NAME=$1
HOST_BIN=$(which "$BIN_NAME")
TARGET_BIN="$TARGET_PREFIX-$BIN_NAME"

FILE="$cur__bin/$BIN_NAME"

cat > $FILE <<EOF
#! /bin/sh

set -e
set -u
if [ "default.$NAME" == "\$(basename \${INSIDE_DUNE:='nope'})" ]; then
    $TARGET_BIN "\$@"
else
    $HOST_BIN "\$@"
fi
EOF
chmod +x $FILE
}

gen_file ar
gen_file as
gen_file ranlib
gen_file strip
